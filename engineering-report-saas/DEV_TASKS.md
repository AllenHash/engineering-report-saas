# 工程可行性报告AI生成系统 - 开发任务清单

## 项目概述
工程可行性报告AI生成SaaS系统，帮助工程咨询工程师自动生成符合中国规范的工程可行性研究报告。

---

## 一、基础设施 (P0)

### 1.1 数据库层
- [ ] **P0-1** 配置 Prisma 并创建数据库 schema
  - 创建 prisma/schema.prisma
  - 定义 User, Report, Project, Template, PointsTransaction, TemplateReview 模型
  - 运行迁移命令创建数据库表
- [ ] **P0-2** 实现数据库连接和查询工具
  - 完善 src/lib/db.ts 数据库操作函数
  - 实现 CRUD 操作封装

### 1.2 环境配置
- [ ] **P0-3** 配置环境变量 (.env)
  - DATABASE_URL
  - JWT_SECRET
  - AI_API_KEY (硅基流动API密钥)
  - AI_BASE_URL

---

## 二、用户系统 (P0)

### 2.1 认证功能
- [x] **P0-4** 用户注册 API (/api/auth/register) ✅
  - 邮箱+密码注册
- [x] **P0-5** 用户登录 API (/api/auth/login) ✅
  - 邮箱+密码登录
- [x] **P0-6** 获取当前用户 API (/api/auth/me) ✅
  - 返回用户信息

### 2.2 积分系统
- [ ] **P0-7** 完善积分获取 API (/api/points)
  - 新用户注册奖励积分
  - 实现积分增减逻辑
  - 记录积分交易历史
- [ ] **P0-8** 创建充值页面 (/profile/recharge)
  - 集成支付网关(支付宝/微信)
  - 充值后增加积分
- [ ] **P0-9** 创建积分历史页面 (/profile/history)
  - 显示积分变动记录

---

## 三、报告管理 (P0)

### 3.1 报告列表
- [ ] **P0-10** 创建报告列表页面 (/reports/page.tsx)
  - 列出用户所有报告
  - 显示报告状态(草稿/生成中/已完成)
  - 提供新建报告入口

### 3.2 报告创建流程
- [ ] **P0-11** 创建报告创建页面 (/create/page.tsx)
  -对话式交互收集项目信息
  - 项目名称、建设地点、工程类型、建设规模、投资估算
- [ ] **P0-12** 实现报告创建 API
  - 保存项目信息到数据库
  - 创建报告记录

### 3.3 报告编辑器
- [ ] **P0-13** 完善报告编辑器页面 (/editor/[id]/page.tsx)
  - 连接数据库获取真实报告数据
  - 实现章节内容保存 API
- [ ] **P0-14** 实现章节树保存 API
  - 新增/重命名/删除章节
  - 调整章节顺序

---

## 四、AI 生成系统 (P0)

### 4.1 对话式交互
- [ ] **P0-15** 完善 /api/chat 对话 API
  - 支持多轮对话上下文
  - 识别用户意图(修改内容/生成新内容)
  - 调用硅基流动API (DeepSeek/GLM)

### 4.2 目录生成
- [ ] **P0-16** 实现 AI 目录生成功能
  - 根据项目信息生成层级化目录结构
  - 支持公路/市政/水利/电力等不同工程类型
- [ ] **P0-17** 创建目录生成 API (/api/reports/outline)
  - 接收项目信息
  - 返回结构化目录

### 4.3 Agent 内容生成
- [ ] **P0-18** 完善章节内容生成 Agent
  - src/lib/agents/contentGenerator.ts
  - 根据章节标题和项目信息生成专业内容
- [ ] **P0-19** 实现多章节并行生成
  - 优化生成速度
  - 积分消耗计算

### 4.4 关键信息联动
- [ ] **P0-20** 完善关键信息联动功能
  - 修改项目信息时自动更新受影响章节
  - 联动影响范围分析

---

## 五、模板系统 (P1)

### 5.1 模板管理
- [ ] **P1-1** 创建模板列表页面 (/templates/page.tsx)
  - 展示系统内置模板
  - 展示用户上传模板
  - 模板预览和搜索
- [ ] **P1-2** 实现模板 API (/api/templates)
  - 获取模板列表
  - 获取模板详情
  - 使用模板创建报告

### 5.2 模板数据结构
- [ ] **P1-3** 定义模板数据模型
  - 章节结构模板
  - 示例内容
  - 提示词模板

---

## 六、导出功能 (P1)

### 6.1 PDF 导出
- [ ] **P1-4** 实现 PDF 导出功能
  - 集成 jspdf + html2canvas
  - 生成符合规范的工程报告格式
- [ ] **P1-5** 创建导出 API (/api/reports/export)
  - 支持 PDF/Word/Markdown 格式

### 6.2 其他格式
- [ ] **P1-6** 支持 Markdown 导出
- [ ] **P1-7** 支持 Word 文档导出 (docx)

---

## 七、管理后台 (P2)

### 7.1 用户管理
- [ ] **P2-1** 创建管理员登录入口
- [ ] **P2-2** 用户列表页面
- [ ] **P2-3** 用户管理功能(禁用/启用/删除)

### 7.2 模板审核
- [ ] **P2-4** 模板审核页面
- [ ] **P2-5** 审核用户提交的自定义模板

### 7.3 数据统计
- [ ] **P2-6** 系统使用统计
- [ ] **P2-7** 营收统计

---

## 八、优化与完善 (P1-P2)

### 8.1 性能优化
- [ ] **P1-8** 实现报告内容缓存
- [ ] **P1-9** AI 响应流式输出

### 8.2 用户体验
- [ ] **P1-10** 报告自动保存功能
- [ ] **P1-11** 进度条显示(AI生成进度)
- [ ] **P2-8** 报告版本历史与回滚

### 8.3 错误处理
- [ ] **P1-12** 完善错误提示
- [ ] **P1-13** API 请求重试机制

---

## 任务优先级说明
- **P0**: 必须完成，系统核心功能
- **P1**: 重要功能，提升用户体验
- **P2**: 次要功能，可后续迭代

---

## 当前状态总结 (2026-02-27 修正)
- ✅ 基础框架 (Next.js + Tailwind + TypeScript)
- ✅ 认证系统 (邮箱注册/登录)
- ✅ 首页对话框 (对话式交互)
- ⚠️ 用户系统需连接数据库
- ✅ 首页三栏布局（项目列表+对话+右侧面板）
- ❌ AI目录生成
- ❌ AI章节内容生成
- ❌ 报告预览/导出
- ❌ 积分系统（按token计费）

## PRD已批准 (2026-02-27)
- MVP目标：邮箱注册、生成目录、生成所有章节、预览报告
- P0: 15项核心功能
- P1: 12项重要功能
- P2: 优化完善期（不增加新功能）