# 工程可行性报告AI生成SaaS - 产品需求文档 (PRD)

**文档版本**：1.1  
**创建日期**：2026-02-27  
**更新日期**：2026-02-27  
**状态**：✅ 已审批  
**负责人**：阿飞  
**审批日期**：2026-02-27

---

## 1. 产品概述

### 1.1 产品定位
通过对话式交互 + 资料上传，帮助工程咨询工程师自动生成符合中国规范的工程可行性研究报告。

### 1.2 目标用户
| 用户群体 | 特征 | 需求痛点 |
|---------|------|---------|
| 大型设计院咨询工程师 | 高质量要求、批量处理 | 报告撰写耗时长、重复劳动多 |
| 中小型事务所 | 预算有限、技术能力弱 | 缺少专业工具、效率低 |
| 个人独立咨询师 | 灵活、追求性价比 | 代写价格高(2万+/份) |

### 1.3 产品形态

**核心形态**：SaaS Web应用
- PC端响应式设计，支持浏览器直接访问
- 移动端暂不开发，待用户量增长后再说

**增值服务**：
- **企业定制化开发**：为企业客户定制私有化的报告生成系统
  - 自有模板设计
  - 品牌定制
  - 私有化部署
  - 专属API对接

### 1.4 核心指标
| 指标 | MVP目标 | V1.0目标 |
|------|---------|----------|
| 注册用户 | 100 | 1,000 |
| 付费转化率 | 5% | 10% |
| 报告生成成功率 | 90% | 98% |
| 用户满意度 | 4.0/5.0 | 4.5/5.0 |

---

## 2. 功能架构

### 2.1 首页布局（借鉴agent.minimax.io）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              首页布局                                        │
├────────────┬────────────────────────────────┬───────────────────────────────┤
│            │                                │                               │
│  项目列表   │        对话区域                │    右侧面板 (可收起)         │
│            │                                │                               │
│  + 新建项目 │  AI对话交互                   │  ┌─────────────────────┐   │
│            │  用户输入需求                   │  │  报告预览            │   │
│  项目1     │  AI引导完善信息                │  │  (只读，不可编辑)    │   │
│  项目2     │                                │  │                     │   │
│  项目3     │                                │  └─────────────────────┘   │
│  ...       │                                │  ┌─────────────────────┐   │
│            │                                │  │  文件预览            │   │
│            │                                │  │  (上传的参考资料)   │   │
│            │                                │  │  (过程文件)         │   │
│            │                                │  └─────────────────────┘   │
├────────────┴────────────────────────────────┴───────────────────────────────┤
│  说明：                                                                   │
│  - 左侧：项目列表，每个对话话题 = 一个项目 = 一条记录                      │
│  - 中间：用户与AI对话交互区域                                            │
│  - 右侧：报告预览(只读) + 文件预览(参考资料、过程文件)，可收起           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 功能模块总览

```
┌─────────────────────────────────────────────────────────────┐
│                        用户端                                │
├─────────────┬─────────────┬─────────────┬─────────────────┤
│   用户系统   │   报告中心   │   模板库    │    积分商城     │
│  注册/登录   │  项目管理   │  选择/预览   │   充值/消耗    │
│  个人中心    │  对话生成   │  上传/分享   │   订单管理     │
│             │  报告预览   │              │                 │
│             │  文件管理   │              │                 │
└─────────────┴─────────────┴─────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        AI引擎                               │
├─────────────┬─────────────┬─────────────┬─────────────────┤
│  意图识别    │  信息提取    │  内容生成    │    报告排版    │
│  intent     │  extract    │  generate   │    formatting   │
├─────────────┴─────────────┴─────────────┴─────────────────┤
│                         质量审核                            │
│                      self-check                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      基础设施                               │
│   硅基流动API   │   数据库   │   文件存储   │   支付网关    │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 功能清单

#### P0 - MVP核心功能（必须完成）

| 序号 | 功能模块 | 功能名称 | 功能描述 | 验收标准 |
|------|---------|---------|---------|---------|
| 1 | 用户系统 | 邮箱注册 | 用户通过邮箱+密码注册账号 | 注册成功获得50积分 |
| 2 | 用户系统 | 邮箱登录 | 邮箱+密码登录 | 输入正确密码即可登录，7天内免登录 |
| 3 | 用户系统 | 完善个人信息 | 填写姓名、公司、职位等 | 可在个人中心编辑保存 |
| 4 | 报告中心 | 首页对话框 | 通过对话框对话创建报告 | 在首页对话框输入需求，AI能响应并引导 |
| 5 | 报告中心 | AI对话输入 | 通过多轮对话补充项目信息 | AI能理解用户输入，持续对话完善信息 |
| 6 | 报告中心 | AI生成报告 | 调用大模型生成报告内容 | 能生成8个章节的完整报告 |
| 7 | 报告中心 | 报告预览 | 在网页上查看报告内容 | 生成的报告可正常展示 |
| 8 | 报告中心 | 逐章节编辑 | 单独编辑任意章节内容 | 能编辑单个章节内容并保存 |
| 9 | 报告中心 | AI重写 | 基于中心思想重新生成单章节 | 点击重写能重新生成该章节 |
| 10 | 报告中心 | 关键信息联动 | 关键信息变更时自动更新相关章节 | 修改投资估算时提示受影响章节 |
| 11 | 报告中心 | 历史报告列表 | 查看过往生成的报告 | 报告列表展示所有历史报告 |
| 12 | 模板库 | 模板选择 | 选择不同工程类型的报告模板 | 能选择公路/市政/水利等模板 |
| 13 | 模板库 | 模板预览 | 查看模板大纲结构 | 预览能看到模板章节结构 |
| 14 | 积分系统 | 积分余额显示 | 查看当前积分 | 个人中心显示当前积分 |
| 15 | 积分系统 | 积分消耗 | 按AI token使用量扣分 | 生成报告按实际token消耗扣分，积分不足时提示 |

#### P1 - V1.0功能（第二阶段）

| 序号 | 功能模块 | 功能名称 | 功能描述 | 优先级 |
|------|---------|---------|---------|-------|
| 16 | 用户系统 | 微信登录 | 支持微信第三方登录 | P1 |
| 17 | 用户系统 | 会员体系 | 区分免费/付费会员 | P1 |
| 18 | 报告中心 | PDF导出 | 导出为PDF文件 | P1 |
| 19 | 报告中心 | Word导出 | 导出为Word文件 | P1 |
| 20 | 报告中心 | 批量生成 | 一次生成多章节目录 | P1 |
| 21 | 模板库 | 模板收藏 | 收藏常用模板 | P1 |
| 22 | 模板库 | 模板搜索 | 按类型/关键词搜索 | P1 |
| 23 | 积分系统 | 积分充值 | 微信支付购买积分 | P1 |
| 24 | 积分系统 | 积分套餐 | 购买不同额度套餐 | P1 |
| 25 | 积分系统 | 积分记录 | 查看积分收支明细 | P1 |
| 26 | AI引擎 | 内容续写 | 继续生成未完成的章节 | P1 |
| 27 | AI引擎 | 内容润色 | 优化已有内容的质量 | P1 |

#### P2 - V1.5阶段（优化完善）

**策略**：不增加新功能，对现有功能进行优化和完善

| 优化方向 | 说明 |
|---------|------|
| 性能优化 | AI响应速度、页面加载优化 |
| 用户体验 | 交互流程优化、界面细节打磨 |
| 稳定性 | Bug修复、异常处理完善 |
| 扩展性 | 架构优化，为后续功能预留 |
| 用户反馈 | 根据实际使用反馈针对性优化 |

**注**：企业账号、团队协作、模板市场上线等功能，待用户规模达到一定量级后再开发。

---

## 3. AI核心生成流程（重要）

### 3.1 总体流程架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI报告生成两阶段流程                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    阶段一：目录结构生成                               │   │
│  │                                                                      │   │
│  │   用户输入 ──▶ 确定报告名称 ──▶ 确定一级目录 ──▶ 确定二级/三级目录   │   │
│  │      │                 │                  │                  │        │   │
│  │      ▼                 ▼                  ▼                  ▼        │   │
│  │   对话交互        AI对话确认         AI对话确认        AI生成中心思想 │   │
│  │   获取信息        修正目录           细化目录          (Outline)      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    阶段二：内容生成                                  │   │
│  │                                                                      │   │
│  │   主Agent ──▶ 任务分发 ──▶ 各章节Agent并行生成 ──▶ 内容组装        │   │
│  │     │              │               │                    │             │   │
│  │     ▼              ▼               ▼                    ▼             │   │
│  │  intent        route_to      chapter1-8          Report             │   │
│  │  recognition   agent         agents              Builder            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 阶段一：目录结构生成（层级化中心思想）

报告结构采用**层级化中心思想**架构：每一级目录都有对应的中心思想，下一级内容服务于上一级的中心思想，内容随着层级深入越来越具体。

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        层级化中心思想架构                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   报告名称：《成灌高速公路建设工程可行性研究报告》                          │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │ 📌 报告中心思想（总结概括）：                                    │      │
│   │ "成灌高速公路建设工程规模适度、技术可行、经济效益良好、           │      │
│   │  社会效益显著，建议尽快实施"                                      │      │
│   ├─────────────────────────────────────────────────────────────────┤      │
│   │ 一级目录（章）：                                                │      │
│   │   1. 总论                                                       │      │
│   │   2. 项目背景与必要性                                            │      │
│   │      → 章节中心思想：项目位于成渝经济圈核心区域，交通需求旺盛... │      │
│   │   3. 建设条件与选址方案                                         │      │
│   │   4. 工程建设方案                                               │      │
│   │   5. 投资估算与资金筹措                                         │      │
│   │   6. 财务评价                                                   │      │
│   │   7. 环境影响评价                                               │      │
│   │   8. 结论与建议                                                 │      │
│   └─────────────────────────────────────────────────────────────────┘      │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │ 2. 项目背景与必要性                                             │      │
│   │   📌 章节中心思想：                                            │      │
│   │   "项目位于成渝经济圈核心区域，交通需求旺盛，现有道路能力         │      │
│   │    不足已成为制约区域发展的瓶颈，扩建工程必要且紧迫"             │      │
│   ├─────────────────────────────────────────────────────────────────┤      │
│   │   2.1 区域概况  ──▶ 小节中心思想：成都市平原向山地过渡带...      │      │
│   │   2.2 经济发展状况  ──▶ 小节中心思想：区域GDP增速快，产业...     │      │
│   │   2.3 交通现状及存在的问题  ──▶ 小节中心思想：现有道路容量...   │      │
│   └─────────────────────────────────────────────────────────────────┘      │
│       │                                                                     │
│       ▼                                                                     │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │   2.3 交通现状及存在的问题                                       │      │
│   │   📌 小节中心思想：                                            │      │
│   │   "成灌高速现状为双向4车道，设计时速80km/h，已运营15年，        │      │
│   │    近年来交通量年均增长12%，高峰期拥堵严重，服务水平降至三级"     │      │
│   ├─────────────────────────────────────────────────────────────────┤      │
│   │   2.3.1 道路现状        ──▶ 内容：基于中心思想生成的具体内容     │      │
│   │   2.3.2 交通流量        ──▶ 内容：基于中心思想生成的具体内容     │      │
│   │   2.3.3 存在的问题      ──▶ 内容：基于中心思想生成的具体内容     │      │
│   └─────────────────────────────────────────────────────────────────┘      │
│       │                                                                     │
│       ▼                                                                     │
│   Agent生成：根据中心思想+上下文+项目信息，生成具体内容                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.1 对话式目录生成流程

通过多轮对话逐步完善报告结构，每一步都需要用户确认：

| 步骤 | 操作 | 输出 |
|------|------|------|
| 步骤1 | 用户描述项目概况 | 原始需求文本 |
| 步骤2 | AI提取关键信息，确定报告名称 | 报告名称 |
| 步骤3 | AI生成一级目录+一级中心思想，用户确认/修改 | 一级目录列表 + 一级中心思想 |
| 步骤4 | AI生成二级目录+二级中心思想（每个一级目录下），用户确认/修改 | 二级目录列表 + 二级中心思想 |
| 步骤5 | AI生成三级目录+三级中心思想（每个二级目录下），用户确认/修改 | 三级目录列表 + 三级中心思想 |
| 步骤6 | 确认完整目录结构，进入内容生成阶段 | 完整Outline |

#### 3.2.2 中心思想说明

中心思想是对该章节/小节**内容的总结概括**（这章节主要讲什么），包含论点论据：

| 层级 | 名称 | 说明 | 示例 |
|------|------|------|------|
| 一级 | 报告中心思想 | 整个报告的总结概括 | 成灌高速公路建设工程规模适度、技术可行、经济效益良好、社会效益显著，建议尽快实施 |
| 二级 | 章节中心思想 | 该章节内容的总结 | 项目位于成渝经济圈核心区域，交通需求旺盛，现有道路能力不足已成为制约区域发展的瓶颈，扩建工程必要且紧迫 |
| 三级 | 小节中心思想 | 该小节内容的总结 | 成灌高速现状为双向4车道，设计时速80km/h，已运营15年，近年来交通量年均增长12%，高峰期拥堵严重，服务水平降至三级以下 |

**核心原则**：
1. **中心思想指导生成**：Agent根据中心思想生成具体内容
2. **内容支撑中心思想**：内容要完整表达中心思想中的论点论据
3. **逐级汇总**：下级中心思想汇总形成上级中心思想
4. **逻辑自洽**：上下级之间论点和论据要一致

**对话示例**：

```
用户: 我要做一条高速公路的可行性研究，在成都到都江堰那边
AI: 好的，我来帮您创建一份公路工程可行性研究报告。

首先请您确认项目信息：
- 项目名称：成灌高速公路建设工程
- 建设地点：四川省成都市至都江堰市
- 工程类型：公路工程（高速公路）

请问这样理解对吗？

用户: 对的，另外这条路大概50公里
AI: 收到，已更新项目信息：建设规模：50公里高速公路

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 报告中心思想（请确认）：
"论证成灌高速公路建设的必要性和技术经济可行性，为项目决策提供依据"
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

一级目录（章）生成完成，请确认：

1. 总论
2. 项目背景与必要性
   → 章节中心思想：项目符合区域发展规划，缓解交通拥堵
3. 建设条件与选址方案
4. 工程建设方案
5. 投资估算与资金筹措
6. 财务评价
7. 环境影响评价
8. 结论与建议

请确认是否需要调整章节或章节中心思想？

用户: 第2章改成"项目建设的必要性"就行
AI: 已调整，继续生成二级目录...
```

### 3.3 阶段二：内容生成（Agent分发）

基于确定的目录结构，调用各专业Agent并行生成内容：

#### 3.3.1 Agent系统架构

每个Agent根据以下信息生成本章节内容：
- **本章节的中心思想**（总结概括）
- **上下文**（上下章节的信息，保持连贯性）
- **项目信息**（项目名称、地点、规模、投资等）

| Agent | 职责 | 负责章节 | 输入 | 输出 |
|-------|------|---------|------|------|
| **main_agent** | 入口、意图识别、路由分发 | 全部 | 用户输入 | 路由决策 |
| **chapter1_agent** | 总论 | 第1章 | 本章中心思想+项目概述+必要性 | 总论内容 |
| **chapter2_agent** | 项目背景 | 第2章 | 本章中心思想+区域概况+发展规划+上下文 | 背景内容 |
| **chapter3_agent** | 选址方案 | 第3章 | 本章中心思想+选址条件+对比分析+上下文 | 选址内容 |
| **chapter4_agent** | 工程建设方案 | 第4章 | 本章中心思想+工程类型+技术参数+上下文 | 工程方案内容 |
| **chapter5_agent** | 投资估算 | 第5章 | 本章中心思想+工程量+投资指标+上下文 | 估算内容 |
| **chapter6_agent** | 财务评价 | 第6章 | 本章中心思想+投资+成本+收益+上下文 | 财务内容 |
| **chapter7_agent** | 环境影响 | 第7章 | 本章中心思想+环保要求+影响评估+上下文 | 环评内容 |
| **chapter8_agent** | 结论与建议 | 第8章 | 全部章节中心思想+项目信息 | 结论内容 |

#### 3.3.2 内容生成流程

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  解析目录    │ ──▶ │  任务队列    │ ──▶ │  并行生成    │
│  结构        │     │  分发        │     │  章节内容    │
└──────────────┘     └──────────────┘     └──────────────┘
                                                  │
                                                  ▼
                     ┌──────────────┐     ┌──────────────┐
                     │  质量检查    │ ◀── │  内容组装    │
                     │  self-check │     │  Report     │
                     └──────────────┘     └──────────────┘
```

#### 3.3.3 主Agent路由规则

基于关键词匹配进行智能路由：

| 关键词 | 路由目标 | 说明 |
|--------|---------|------|
| 市政道路、总投资、建设规模 | chapter1_agent | 总论相关 |
| 项目背景、交通拥堵、经济发展 | chapter2_agent | 背景相关 |
| 位于、选址、地下水位、地形 | chapter3_agent | 选址相关 |
| 道路工程、桥梁工程、排水工程 | chapter4_agent | 工程方案 |
| 投资、估算、资金、造价 | chapter5_agent | 投资估算 |
| 财务、收益、成本、利润 | chapter6_agent | 财务评价 |
| 环境、污染、生态、节能 | chapter7_agent | 环境影响 |
| 结论、建议、总结 | chapter8_agent | 结论建议 |

### 3.4 路由决策算法

```typescript
interface RouteDecision {
  targetAgent: string;
  confidence: number;      // 置信度 0-1
  keywords: string[];     // 匹配的关键词
  context: string;        // 上下文摘要
}

// 路由决策流程
function routeToAgent(userInput: string, context: Context): RouteDecision {
  // 1. 提取关键词
  const keywords = extractKeywords(userInput);
  
  // 2. 匹配Agent
  for (const rule of routingRules) {
    if (rule.keywords.some(k => keywords.includes(k))) {
      return {
        targetAgent: rule.agent,
        confidence: calculateConfidence(keywords, rule.keywords),
        keywords: matchedKeywords,
        context: summarizeContext(context)
      };
    }
  }
  
  // 3. 默认路由到main_agent处理
  return { targetAgent: 'main_agent', confidence: 0.5, keywords: [], context: '' };
}
```

### 3.5 上下文管理

每个Agent生成内容时，需要维护完整的上下文：

```typescript
interface ReportContext {
  // 项目基础信息
  projectInfo: {
    name: string;           // 项目名称
    location: string;       // 建设地点
    type: ProjectType;      // 工程类型
    scale: string;          // 建设规模
    investment: string;     // 投资估算
  };
  
  // 目录结构
  outline: {
    level1: string[];      // 一级目录
    level2: Record<string, string[]>;  // 二级目录
    level3: Record<string, string[]>;  // 三级目录
    centralIdeas: Record<string, string>;  // 中心思想
  };
  
  // 已生成内容
  generatedContent: {
    [chapterId: string]: {
      content: string;
      wordCount: number;
      generatedAt: Date;
    }
  };
  
  // 对话历史
  conversationHistory: Message[];
}
```

### 3.6 质量保障机制

| 机制 | 说明 |
|------|------|
| **自检Agent** | 生成后进行质量检查（完整性、专业性、一致性） |
| **重试机制** | 生成失败自动重试3次 |
| **超时保护** | 单章节生成超时60s后返回提示 |
| **降级策略** | API不稳定时使用备用模型 |

---

## 4. 用户流程（对话式）

### 4.1 核心用户旅程

**首页三栏布局**：
```
┌────────────┬────────────────────────────────┬───────────────────────────────┐
│            │                                │                               │
│  项目列表   │       对话交互区域             │    右侧面板 (可收起)          │
│            │                                │                               │
│ + 新建项目 │  [AI]: 你好，请描述项目...   │  [📄 报告预览] [📁 文件]     │
│            │                                │                               │
│ 项目A     │  [用户]: 我要做一条高速...    │  ┌─────────────────────┐     │
│ 项目B     │                                │  │ 报告内容只读        │     │
│ 项目C     │  ─────────────────────────    │  │                     │     │
│            │                                │  │ 1. 总论            │     │
│            │  [输入框...] [发送]          │  │ 2. 项目背景        │     │
│            │                                │  └─────────────────────┘     │
└────────────┴────────────────────────────────┴───────────────────────────────┘
```

**交互流程**：
1. 新建项目 → 对话创建报告
2. 每个对话 = 一个项目（左侧项目列表中显示）
3. 对话过程中，右侧实时预览报告内容
4. 用户可上传参考资料到文件区

### 4.2 对话式流程详解

#### 阶段一：注册/登录
1. 用户进入首页
2. 选择登录方式（邮箱+密码）
3. 验证成功后进入工作台

#### 阶段二：AI对话 + 模板推荐
1. 用户描述项目概况（语音/文字）
2. AI通过对话提取关键信息
3. **AI根据项目特征推荐合适模板**（用户可选）
4. 用户确认或更换模板

**对话示例**：
```
用户: 我要做一条高速公路的可行性研究
AI: 好的，我来帮您创建公路工程可行性研究报告。
    请问这条路大概在哪个位置？
    
用户: 在成都到都江堰这边
AI: 收到，请问道路大约多长？另外预计投资大概多少？
    
用户: 大概50公里，投资大概10个亿左右
AI: 根据您提供的信息，我为您推荐以下模板：
    ┌─────────────────────────────────────────┐
    │  推荐模板：公路工程可行性研究报告大纲   │
    │  适用：高速公路新建/改扩建项目           │
    │  章节：8章                              │
    └─────────────────────────────────────────┘
    
    [确认使用此模板]  [查看其他模板]
    
用户: 可以，用这个吧
```

#### 阶段三：完善项目信息（对话式）
1. AI基于已获取信息，继续提问获取更多细节
2. 用户通过对话补充信息
3. 可选择**上传资料**（图片/Excel/文档）辅助说明
4. AI实时提取并展示已获取信息
5. 用户可随时修改/补充

**对话示例**：
```
AI: 好的，已选择"公路工程可行性研究报告大纲"。
    现在继续完善项目信息：
    
    ┌─────────────────────────────────────────┐
    │  已获取信息：                           │
    │  - 项目名称：待定                       │
    │  - 建设地点：成都市至都江堰市           │
    │  - 建设规模：50公里                     │
    │  - 投资估算：10亿元                     │
    └─────────────────────────────────────────┘
    
    请问项目名称您想怎么命名？
    
用户: 就叫成灌高速公路建设工程吧
AI: 好的，项目名称已更新为"成灌高速公路建设工程"。
    
    请问这条路的建设单位是谁？
    
用户: 成都市交通局
AI: 收到。请问道路设计时速是多少？车道数是几车道？
    
    [用户可选择上传设计资料文件]
```

#### 阶段四：目录审批（关键节点）
**用户必须审批确认后才能进入下一步**

1. **项目名称确认** → 用户确认后锁定
2. **一级目录确认** → 用户审批后锁定，进入二级目录生成
3. **二级目录确认** → 用户审批后锁定，进入三级目录生成
4. **三级目录确认** → 用户审批后锁定，进入内容生成

**审批界面示例**：
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 项目名称：成灌高速公路建设工程
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
请确认项目名称是否正确？
[确认] [修改]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 一级目录（章）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 总论
2. 项目建设的必要性
3. 建设条件与选址方案
4. 工程建设方案
5. 投资估算
6. 财务评价
7. 环境影响评价
8. 结论与建议

请确认一级目录是否需要调整？
[确认] [调整]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 二级目录（2. 项目建设的必要性）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
2.1 区域概况
2.2 经济发展状况
2.3 交通现状及存在的问题
2.4 项目建设的必要性

请确认二级目录是否需要调整？
[确认] [调整]
```

#### 阶段五：内容生成
1. 用户确认三级目录后，点击"开始生成"
2. 系统检查积分余额
3. 扣除积分（如需要）
4. 调用各Agent并行生成内容
5. 展示生成进度
6. 生成完成，用户可预览/编辑

#### 阶段六：后期处理

1. **预览完整报告** - 查看所有章节内容
2. **逐章节修改调整** - 用户可单独编辑任意章节
3. **关键信息联动更新** - 项目关键信息变更时，相关章节自动更新
4. **导出PDF/Word** - 导出最终报告
5. **保存至历史记录**

---

### 4.3 报告编辑与联动更新机制

#### 4.3.1 逐章节修改

报告生成完成后，用户可逐章节查看和修改内容：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        报告详情页                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│  报告名称：成灌高速公路建设工程可行性研究报告         [导出PDF] [导出Word] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 1. 总论                                          [查看] [编辑] [AI重写]│
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ 2. 项目建设的必要性                              [查看] [编辑] [AI重写]│
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ 3. 建设条件与选址方案                            [查看] [编辑] [AI重写]│
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ ...                                                                    │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  项目关键信息：                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ 项目名称：成灌高速公路建设工程          [编辑]                        │
│  │ 建设地点：四川省成都市至都江堰市       [编辑]                        │
│  │ 建设规模：50公里                        [编辑]                        │
│  │ 投资估算：10亿元                        [编辑]                        │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**每个章节支持**：
- **查看**：展开查看完整内容
- **编辑**：手动输入修改内容
- **AI重写**：基于当前中心思想重新生成该章节

#### 4.3.2 关键信息联动更新机制

当用户修改项目关键信息时，系统自动检测受影响章节并提示用户是否需要更新：

**关键信息列表**：
| 信息项 | 影响章节 |
|--------|---------|
| 项目名称 | 全部章节 |
| 建设地点 | 背景分析、选址方案、环境影响 |
| 建设规模 | 工程方案、投资估算、财务评价 |
| 投资估算 | 投资估算、财务评价、资金筹措 |
| 建设单位 | 总论、资金筹措 |
| 工程类型 | 全部章节（可能需要换模板） |

**联动更新流程**：
```
用户修改关键信息（如：将投资10亿改为15亿）
        │
        ▼
系统检测受影响章节
        │
        ▼
展示受影响章节列表：
"修改投资估算将影响以下章节：5.投资估算、6.财务评价"
        │
        ▼
用户选择：
[仅更新本章] [更新全部受影响章节] [取消]
        │
        ▼
执行更新：
- 扣除相应积分（如需AI重写）
- 调用Agent重新生成受影响章节
- 保持未受影响章节不变
```

**联动更新策略**：
| 更新范围 | 适用场景 | 积分消耗 |
|---------|---------|---------|
| 仅当前章节 | 小范围调整 | 1次生成 |
| 全部受影响章节 | 关键信息重大变更 | 多次生成 |
| 整个报告 | 核心假设变更 | 全部重新生成 |

---

## 5. 页面结构

### 5.1 页面清单

| 页面 | 路径 | 描述 | 访问权限 |
|------|------|------|---------|
| 首页/工作台 | `/` | 对话式创建报告（核心页面） | 登录 |
| 登录 | `/login` | 邮箱密码登录 | 未登录 |
| 注册 | `/register` | 邮箱密码注册 | 未登录 |
| 报告编辑器 | `/editor/[id]` | 查看/编辑报告 | 登录 |
| 历史报告 | `/reports` | 报告列表 | 登录 |
| 模板库 | `/templates` | 浏览/选择模板 | 登录 |
| 个人中心 | `/profile` | 用户信息/设置 | 登录 |
| 积分充值 | `/profile/recharge` | 积分充值 | 登录 |
| 积分历史 | `/profile/history` | 积分变动记录 | 登录 |
| 消息通知 | `/notifications` | 站内消息 | 登录 |

### 5.2 页面详细设计

#### 首页/工作台 (`/`) - 核心页面
```
┌────────────────────────────────────────────────────────────┐
│  [Logo]  工程可行性报告AI助手        [积分: 100] [头像]   │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    对话区域                          │   │
│  │                                                      │   │
│  │  [AI]: 你好，你需要写什么类型的报告？              │   │
│  │                                                      │   │
│  │  ─────────────────────────────────────────────────  │   │
│  │                                                      │   │
│  │  [用户输入框...]              [发送]                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                            │
│   ──────────── 最近报告 ────────────                       │
│   ┌──────────────────────────────────────────────────┐    │
│   │ 成灌高速公路可行性研究报告          2026-02-26  │    │
│   │ 状态：已完成                      [查看] [删除]  │    │
│   └──────────────────────────────────────────────────┘    │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**交互方式**：
- 用户在对话框输入项目需求
- AI通过多轮对话引导用户完善信息
- 支持选择工程类型、模板等
- 确认后自动生成报告

#### 5.3 整体页面风格

**设计风格**：现代简洁深色系（Dark Mode）

**配色方案**：
- 主色：深灰 (#1a1a2e) + 蓝色强调 (#3b82f6)
- 文字：白色/浅灰
- 卡片：深灰 (#262640)
- 按钮：蓝色渐变

**布局特点**：
- 顶部导航栏（Logo + 积分 + 头像）
- 主体内容区域（自适应）
- 底部固定输入框（对话场景）
- 左侧边栏可折叠（报告列表）

**组件风格**：
- 圆角卡片 (rounded-lg)
- 轻微阴影 (shadow-md)
- 悬停动效 (transition-colors)
- 加载状态 (loading skeleton)

---

## 6. 技术架构

### 6.1 技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 前端框架 | Next.js 14 | React全栈框架 |
| UI组件 | Tailwind CSS + shadcn/ui | 现代简洁风格 |
| 后端 | Next.js API Routes | Serverless API |
| 数据库 | SQLite (开发) / PostgreSQL (生产) | 关系型数据 |
| AI Provider | 硅基流动 (SiliconFlow) | DeepSeek/GLM等模型 |
| 文件存储 | 本地存储 (开发) / OSS (生产) | PDF/Word文件 |
| 支付 | 微信支付 | 积分充值 |
| 认证 | JWT + 邮箱密码 | 安全登录 |

### 6.2 核心模块设计

#### 5.2.1 AI引擎架构

```
┌─────────────────────────────────────────────────────────────┐
│                      AI Engine                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │ Intent     │    │ Info        │    │ Content     │     │
│  │ Recognition│    │ Extraction  │    │ Generator   │     │
│  │            │    │             │    │             │     │
│  │ - 分析用户  │    │ - 关键信息  │    │ - 章节生成  │     │
│  │   输入意图  │    │   提取      │    │ - 多模型    │     │
│  │ - 关键词    │    │ - 信息补全  │    │   调用      │     │
│  │   匹配      │    │   提示      │    │ - 内容优化  │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│          │                │                 │              │
│          └────────────────┼─────────────────┘              │
│                           ▼                                 │
│                  ┌─────────────────┐                       │
│                  │  Report Builder │                       │
│                  │  - 章节组装      │                       │
│                  │  - 格式转换      │                       │
│                  │  - 质量检查      │                       │
│                  └─────────────────┘                       │
└─────────────────────────────────────────────────────────────┘
```

#### 5.2.2 Agent系统设计

| Agent | 职责 | 输入 | 输出 |
|-------|------|------|------|
| main_agent | 入口、意图判断、路由 | 用户原始输入 | 路由到具体Agent |
| chapter1_agent | 总论/概述 | 项目信息 | 项目概述、建设必要性等 |
| chapter2_agent | 项目背景 | 项目信息、地理位置 | 区域概况、经济发展等 |
| chapter3_agent | 选址方案 | 选址条件、对比分析 | 选址结论、推荐方案 |
| chapter4_agent | 工程建设方案 | 工程类型、技术参数 | 道路/桥梁/排水等方案 |
| chapter5_agent | 投资估算 | 工程量、投资指标 | 估算书、资金筹措 |
| chapter6_agent | 财务评价 | 投资、成本、收益 | 财务指标、敏感性分析 |
| chapter7_agent | 环境影响 | 环保要求、影响评估 | 环保措施、评价结论 |
| chapter8_agent | 结论与建议 | 全部章节 | 综合结论、建议 |

### 6.3 数据库设计

#### 用户表 (users)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | VARCHAR(36) | 主键UUID |
| email | VARCHAR(100) | 邮箱（唯一） |
| password_hash | VARCHAR(255) | 密码哈希 |
| nickname | VARCHAR(50) | 昵称 |
| company | VARCHAR(100) | 公司 |
| role | VARCHAR(20) | 角色：free/vip/admin |
| points | INT | 积分余额 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 报告表 (reports)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | VARCHAR(36) | 主键UUID |
| user_id | VARCHAR(36) | 外键关联用户 |
| template_id | VARCHAR(36) | 模板ID |
| title | VARCHAR(200) | 报告标题 |
| project_info | JSON | 项目信息 |
| content | JSON | 报告内容（章节JSON） |
| status | VARCHAR(20) | 状态：draft/generating/completed |
| quality_score | INT | 质量评分 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 模板表 (templates)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | VARCHAR(36) | 主键UUID |
| name | VARCHAR(100) | 模板名称 |
| industry | VARCHAR(50) | 行业类型 |
| version | VARCHAR(20) | 版本号 |
| outline | JSON | 大纲结构 |
| is_premium | BOOLEAN | 是否付费 |
| points_required | INT | 所需积分 |
| usage_count | INT | 使用次数 |
| created_at | DATETIME | 创建时间 |

#### 积分记录表 (point_transactions)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | VARCHAR(36) | 主键UUID |
| user_id | VARCHAR(36) | 外键关联用户 |
| type | VARCHAR(20) | 类型：earn/spend/recharge |
| amount | INT | 积分数量 |
| balance_after | INT | 变动后余额 |
| description | VARCHAR(200) | 描述 |
| reference_id | VARCHAR(36) | 关联ID（报告/订单） |
| created_at | DATETIME | 创建时间 |

---

## 7. 积分与商业模式

### 6.1 积分体系

**积分计算方式**：按AI token使用量计费

| 行为 | 积分变化 | 说明 |
|------|---------|------|
| 新用户注册 | +50 | 首次注册赠送 |
| 每日签到 | +5 | 连续签到+10 |
| AI生成报告 | -按量计费 | 按实际消耗的token数量扣分 |
| 导出PDF | -10 | 额外消耗 |
| 导出Word | -20 | 额外消耗（比PDF多，Word需要额外排版） |
| 邀请用户 | +30 | 成功邀请 |
| 充值 | 1元=10积分 | 购买比例 |

**Token计费规则**：
- AI生成报告按实际token消耗计费
- 1Token ≈ 1积分（根据模型价格动态调整）

### 6.2 充值套餐

| 套餐名称 | 价格 | 积分 | 赠送 | 有效期 |
|---------|------|------|------|-------|
| 体验包 | ¥49 | 490 | 50 | 30天 |
| 基础包 | ¥99 | 990 | 150 | 90天 |
| 标准包 | ¥199 | 1990 | 400 | 180天 |
| 高级包 | ¥499 | 4990 | 1500 | 365天 |
| 企业包 | ¥999 | 10000 | 2000 | 365天 |

### 6.3 会员权益

| 权益 | 免费用户 | VIP会员 |
|------|---------|---------|
| 生成报告 | ✓ | ✓ |
| PDF导出 | ✗ | ✓ |
| 模板数量 | 3个 | 全部 |
| 优先生成 | ✗ | ✓ |
| 专属客服 | ✗ | ✓ |
| 会员价格 | - | ¥99/月 |

---

## 8. 非功能性需求

### 7.1 性能要求
| 指标 | 要求 |
|------|------|
| 页面加载时间 | < 2秒 |
| 报告生成时间 | < 60秒（3章节） |
| API响应时间 | < 500ms |
| 系统可用性 | 99.9% |

### 7.2 安全要求
- 用户密码加密存储（bcrypt）
- API接口JWT认证
- 敏感信息脱敏展示
- 数据定期备份
- SQL注入防护

### 7.3 兼容性要求
- Chrome >= 90
- Firefox >= 88
- Safari >= 14
- Edge >= 90
- 移动端：iOS Safari >= 14 / Android Chrome >= 90

---

## 9. 里程碑规划

### 8.1 MVP阶段（Day 1-14）

| 周次 | 任务 | 交付物 |
|------|------|-------|
| 第1周 | 用户系统基础（注册/登录） | 登录页面、API |
| 第1周 | 报告创建与信息填写 | 创建流程页面 |
| 第2周 | AI生成基础功能 | 报告生成API |
| 第2周 | 报告预览与编辑 | 预览/编辑器页面 |
| 第2周 | 模板库基础 | 模板展示、选择 |

**MVP验收标准**：
- [ ] 用户可通过邮箱注册、登录
- [ ] 可通过对话框对话创建报告
- [ ] AI能生成报告目录（一级、二级、三级目录结构）
- [ ] AI能生成所有章节内容（不求精确，能看即可）
- [ ] 可以在网页上预览生成的报告
- [ ] 可以选择不同工程类型的模板
- [ ] 积分系统正常工作（注册送积分、生成扣积分）

### 8.2 V1.0阶段（Day 15-30）

| 周次 | 任务 | 交付物 |
|------|------|-------|
| 第3周 | 积分系统 | 积分充值、消耗、记录 |
| 第3周 | PDF/Word导出 | 导出功能 |
| 第4周 | 模板搜索与收藏 | 搜索、收藏功能 |
| 第4周 | 优化与Bug修复 | 性能优化、Bug修复 |

**V1.0验收标准**：
- [ ] 积分可充值消费
- [ ] 可导出PDF文件
- [ ] 模板可搜索
- [ ] 报告可收藏

### 8.3 V1.5阶段（Day 31-60）- 优化完善期

| 周次 | 任务 | 交付物 |
|------|------|-------|
| 第5-6周 | 性能优化 | AI响应速度、页面加载优化 |
| 第5-6周 | 用户体验优化 | 交互流程优化、界面细节打磨 |
| 第7-8周 | 稳定性提升 | Bug修复、异常处理完善 |
| 第7-8周 | 架构优化 | 代码重构、扩展性优化 |

**注**：企业账号、团队协作、模板市场上线等功能，待用户规模达到一定量级后再开发。

---

## 10. 风险与应对

| 风险 | 等级 | 应对方案 |
|------|------|---------|
| AI生成质量不稳定 | 高 | 文本库方案兜底 + 人工校对 |
| 用户不愿付费 | 中 | 先用免费功能验证需求 |
| 大模型API不稳定 | 中 | 多模型备选（DeepSeek/GLM/Qwen） |
| 微信支付接入难 | 中 | 手动充值过渡 |
| 技术实现复杂度 | 中 | 分阶段实现、优先级排序 |

---

## 11. 后续待定

- [ ] UI设计稿（需UI设计师介入）
- [ ] 详细API接口文档
- [ ] 第三方服务合同（支付通道）
- [ ] 用户隐私政策
- [ ] 服务条款

---

**审批记录**

| 版本 | 日期 | 审批人 | 状态 |
|------|------|--------|------|
| 1.0 | 2026-02-27 | - | 待审批 |

---

*本PRD基于现有代码实现和战略规划制定，将作为开发执行的核心依据。*
