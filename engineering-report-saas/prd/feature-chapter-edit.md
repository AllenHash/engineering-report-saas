# 开发任务：逐章节编辑与AI重写功能

## 任务概述
为工程可行性报告SaaS系统增加逐章节编辑和AI重写功能

## 需求背景
用户生成报告后，可能需要对特定章节进行调整优化。需要提供：
1. 逐章节查看和编辑内容
2. AI重写单个章节功能

## 页面位置
- 路径：`/reports/[id]` 或新建 `/editor/[reportId]`
- 入口：从报告列表或生成后的报告点击"编辑"

## 功能需求

### 1. 章节列表展示
- 显示报告的完整章节树（一级 + 二级目录）
- 点击章节可展开/收起子章节
- 当前编辑的章节高亮显示
- 显示每章节的字数统计

### 2. 章节内容编辑
- 富文本编辑器（支持 Markdown）
- 支持撤销/重做
- 自动保存草稿
- 字数统计显示
- 保存按钮

### 3. AI重写功能
- 入口：每个章节标题旁有"AI重写"按钮
- 点击后弹出对话框
- 用户可输入重写要求（如："更专业一些"、"缩短到500字"）
- AI基于章节主题重新生成内容
- 显示新旧内容对比
- 用户确认后替换

### 4. 章节操作
- 新增章节
- 删除章节
- 调整章节顺序（拖拽）

## 交互流程
```
报告列表 → 选择报告 → 章节列表 → 选择章节 → 编辑内容
                                              ↓
                                    点击"AI重写" → 输入要求 → 生成 → 确认替换
```

## 页面UI设计
- 左侧：章节导航树
- 中间：编辑器区域
- 右侧：AI重写面板（可选展开）

## 技术实现
- 使用 Tiptap 或 Slate 作为富文本编辑器
- 复用现有的 `/api/chat` 进行AI对话
- 新增 `/api/reports/[id]/sections/[sectionId]` API

## 验收标准
1. ✅ 可以查看报告的完整章节结构
2. ✅ 可以编辑任意章节的内容
3. ✅ 可以使用AI重写单个章节
4. ✅ AI重写可以指定要求（如字数、风格）
5. ✅ 编辑内容可以保存
6. ✅ 页面响应流畅

## 开发优先级
- P0：章节列表 + 内容编辑 + 保存
- P1：AI重写功能
- P2：新增/删除/拖拽章节

## 预计工时
- 页面开发：2小时
- AI重写：1小时
- 测试调优：1小时

---

**产品经理**：阿飞
**状态**：待开发
**开发者**：Claude Code (frontend agent)
